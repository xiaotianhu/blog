<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  [原创翻译]QueryPath PHP的Jquery实现,QueryPath教程 - Rainyluo's BLOG
  
  </title>
 <meta name="description" content="">
 <link href="atom.xml" rel="alternate" title="Rainyluo's BLOG" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">Rainyluo's BLOG</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; Rainyluo's BLOG</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>Hyperf</label></li>

          
            <li><a title="# Hyperf源码阅读 第二章 HTTP服务初始化" href="15932480961729.html"># Hyperf源码阅读 第二章 HTTP服务初始化</a></li>
          
            <li><a title="Hyperf源码阅读 第一章 初始化" href="15928236190986.html">Hyperf源码阅读 第一章 初始化</a></li>
          

      
        <li class="divider"></li>
        <li><label>随感</label></li>

          
            <li><a title="如何变得平庸" href="15923063082122.html">如何变得平庸</a></li>
          
            <li><a title="一个实用主义者的反思" href="15923063082072.html">一个实用主义者的反思</a></li>
          
            <li><a title="2018-08-01 感想" href="15923063081475.html">2018-08-01 感想</a></li>
          
            <li><a title="2019的成长" href="15923063084995.html">2019的成长</a></li>
          
            <li><a title="细节与功利主义：致那些同我一样想突破自己技术层级的朋友们" href="15771974682027.html">细节与功利主义：致那些同我一样想突破自己技术层级的朋友们</a></li>
          
            <li><a title="审美是一切美好追求的基础" href="15706010504336.html">审美是一切美好追求的基础</a></li>
          
            <li><a title="什么叫"回归初心" 以及技术成长突破的心态" href="15696591889118.html">什么叫"回归初心" 以及技术成长突破的心态</a></li>
          

      
        <li class="divider"></li>
        <li><label>其他</label></li>

          
            <li><a title="PHP的 Generator(yield)有啥用" href="16043884086250.html">PHP的 Generator(yield)有啥用</a></li>
          
            <li><a title="理解矩阵" href="15936798966495.html">理解矩阵</a></li>
          
            <li><a title="cocopods重装解决framework not found Pods/no such module" href="15923063082414.html">cocopods重装解决framework not found Pods/no such module</a></li>
          
            <li><a title="pts导入bts2.0教程" href="15923063083603.html">pts导入bts2.0教程</a></li>
          
            <li><a title="gopush代码分析-comet模块" href="15923063083769.html">gopush代码分析-comet模块</a></li>
          
            <li><a title="Chrome Extension扩展开发之复制粘贴" href="15923063083833.html">Chrome Extension扩展开发之复制粘贴</a></li>
          
            <li><a title="iowait详解" href="15923063084125.html">iowait详解</a></li>
          
            <li><a title="mac安装mysql-python(with XAMPP)" href="15923063084788.html">mac安装mysql-python(with XAMPP)</a></li>
          
            <li><a title="App内使用H5页面的一个安全问题" href="15923063086512.html">App内使用H5页面的一个安全问题</a></li>
          
            <li><a title="PHP 通过Apns给Ios设备推送Notification" href="15923063086602.html">PHP 通过Apns给Ios设备推送Notification</a></li>
          
            <li><a title="python中使用import加载目录中全部文件" href="15923063087292.html">python中使用import加载目录中全部文件</a></li>
          
            <li><a title="kvm/virsh 异常断电导致虚拟机无法启动的修复实战" href="15923063088164.html">kvm/virsh 异常断电导致虚拟机无法启动的修复实战</a></li>
          
            <li><a title="Synology office error: User home service is not enabled" href="15923063081281.html">Synology office error: User home service is not enabled</a></li>
          
            <li><a title="git commit后自动检查php文件语法" href="15923063081235.html">git commit后自动检查php文件语法</a></li>
          
            <li><a title="梅林固件/R6300V2 安装Lcd4Linux显示屏" href="15923063081215.html">梅林固件/R6300V2 安装Lcd4Linux显示屏</a></li>
          

      
        <li class="divider"></li>
        <li><label>About</label></li>

          
            <li><a title="Rainyluo's Blog" href="15923063081658.html">Rainyluo's Blog</a></li>
          

      
        <li class="divider"></li>
        <li><label>PHP</label></li>

          
            <li><a title="二维数组排序 array multisort" href="15756185241314.html">二维数组排序 array multisort</a></li>
          
            <li><a title="PHP中的闭包理解" href="15931630289738.html">PHP中的闭包理解</a></li>
          
            <li><a title="reactPHP + lumen性能简测" href="15923063083212.html">reactPHP + lumen性能简测</a></li>
          
            <li><a title="QueryPath中文乱码问题,UTF8乱码问题解决" href="15923063084242.html">QueryPath中文乱码问题,UTF8乱码问题解决</a></li>
          
            <li><a title="WorkerMan的restart命令的一个Bug修复记录" href="15923063084445.html">WorkerMan的restart命令的一个Bug修复记录</a></li>
          
            <li><a title="PHP的多线程Curl,rolling Curl实现与坑" href="15923063085282.html">PHP的多线程Curl,rolling Curl实现与坑</a></li>
          
            <li><a title="用PHP-CLI在SHELL中输出颜色" href="15923063085495.html">用PHP-CLI在SHELL中输出颜色</a></li>
          
            <li><a title="使用GITHUB+JustWriting搭建BLOG" href="15923063087852.html">使用GITHUB+JustWriting搭建BLOG</a></li>
          
            <li><a title="[原创翻译]QueryPath PHP的Jquery实现,QueryPath教程" href="15923063087972.html">[原创翻译]QueryPath PHP的Jquery实现,QueryPath教程</a></li>
          
            <li><a title="(伪)异步实现加速PHP接口的返回速度" href="15923063089153.html">(伪)异步实现加速PHP接口的返回速度</a></li>
          
            <li><a title="PHP调试技巧" href="15922725010749.html">PHP调试技巧</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>Hyperf</span></li>
                        
                          <li><a title="# Hyperf源码阅读 第二章 HTTP服务初始化" href="15932480961729.html"># Hyperf源码阅读 第二章 HTTP服务初始化</a></li>
                        
                          <li><a title="Hyperf源码阅读 第一章 初始化" href="15928236190986.html">Hyperf源码阅读 第一章 初始化</a></li>
                        

                    
                      <li class="side-title"><span>随感</span></li>
                        
                          <li><a title="如何变得平庸" href="15923063082122.html">如何变得平庸</a></li>
                        
                          <li><a title="一个实用主义者的反思" href="15923063082072.html">一个实用主义者的反思</a></li>
                        
                          <li><a title="2018-08-01 感想" href="15923063081475.html">2018-08-01 感想</a></li>
                        
                          <li><a title="2019的成长" href="15923063084995.html">2019的成长</a></li>
                        
                          <li><a title="细节与功利主义：致那些同我一样想突破自己技术层级的朋友们" href="15771974682027.html">细节与功利主义：致那些同我一样想突破自己技术层级的朋友们</a></li>
                        
                          <li><a title="审美是一切美好追求的基础" href="15706010504336.html">审美是一切美好追求的基础</a></li>
                        
                          <li><a title="什么叫"回归初心" 以及技术成长突破的心态" href="15696591889118.html">什么叫"回归初心" 以及技术成长突破的心态</a></li>
                        

                    
                      <li class="side-title"><span>其他</span></li>
                        
                          <li><a title="PHP的 Generator(yield)有啥用" href="16043884086250.html">PHP的 Generator(yield)有啥用</a></li>
                        
                          <li><a title="理解矩阵" href="15936798966495.html">理解矩阵</a></li>
                        
                          <li><a title="cocopods重装解决framework not found Pods/no such module" href="15923063082414.html">cocopods重装解决framework not found Pods/no such module</a></li>
                        
                          <li><a title="pts导入bts2.0教程" href="15923063083603.html">pts导入bts2.0教程</a></li>
                        
                          <li><a title="gopush代码分析-comet模块" href="15923063083769.html">gopush代码分析-comet模块</a></li>
                        
                          <li><a title="Chrome Extension扩展开发之复制粘贴" href="15923063083833.html">Chrome Extension扩展开发之复制粘贴</a></li>
                        
                          <li><a title="iowait详解" href="15923063084125.html">iowait详解</a></li>
                        
                          <li><a title="mac安装mysql-python(with XAMPP)" href="15923063084788.html">mac安装mysql-python(with XAMPP)</a></li>
                        
                          <li><a title="App内使用H5页面的一个安全问题" href="15923063086512.html">App内使用H5页面的一个安全问题</a></li>
                        
                          <li><a title="PHP 通过Apns给Ios设备推送Notification" href="15923063086602.html">PHP 通过Apns给Ios设备推送Notification</a></li>
                        
                          <li><a title="python中使用import加载目录中全部文件" href="15923063087292.html">python中使用import加载目录中全部文件</a></li>
                        
                          <li><a title="kvm/virsh 异常断电导致虚拟机无法启动的修复实战" href="15923063088164.html">kvm/virsh 异常断电导致虚拟机无法启动的修复实战</a></li>
                        
                          <li><a title="Synology office error: User home service is not enabled" href="15923063081281.html">Synology office error: User home service is not enabled</a></li>
                        
                          <li><a title="git commit后自动检查php文件语法" href="15923063081235.html">git commit后自动检查php文件语法</a></li>
                        
                          <li><a title="梅林固件/R6300V2 安装Lcd4Linux显示屏" href="15923063081215.html">梅林固件/R6300V2 安装Lcd4Linux显示屏</a></li>
                        

                    
                      <li class="side-title"><span>About</span></li>
                        
                          <li><a title="Rainyluo's Blog" href="15923063081658.html">Rainyluo's Blog</a></li>
                        

                    
                      <li class="side-title"><span>PHP</span></li>
                        
                          <li><a title="二维数组排序 array multisort" href="15756185241314.html">二维数组排序 array multisort</a></li>
                        
                          <li><a title="PHP中的闭包理解" href="15931630289738.html">PHP中的闭包理解</a></li>
                        
                          <li><a title="reactPHP + lumen性能简测" href="15923063083212.html">reactPHP + lumen性能简测</a></li>
                        
                          <li><a title="QueryPath中文乱码问题,UTF8乱码问题解决" href="15923063084242.html">QueryPath中文乱码问题,UTF8乱码问题解决</a></li>
                        
                          <li><a title="WorkerMan的restart命令的一个Bug修复记录" href="15923063084445.html">WorkerMan的restart命令的一个Bug修复记录</a></li>
                        
                          <li><a title="PHP的多线程Curl,rolling Curl实现与坑" href="15923063085282.html">PHP的多线程Curl,rolling Curl实现与坑</a></li>
                        
                          <li><a title="用PHP-CLI在SHELL中输出颜色" href="15923063085495.html">用PHP-CLI在SHELL中输出颜色</a></li>
                        
                          <li><a title="使用GITHUB+JustWriting搭建BLOG" href="15923063087852.html">使用GITHUB+JustWriting搭建BLOG</a></li>
                        
                          <li><a title="[原创翻译]QueryPath PHP的Jquery实现,QueryPath教程" href="15923063087972.html">[原创翻译]QueryPath PHP的Jquery实现,QueryPath教程</a></li>
                        
                          <li><a title="(伪)异步实现加速PHP接口的返回速度" href="15923063089153.html">(伪)异步实现加速PHP接口的返回速度</a></li>
                        
                          <li><a title="PHP调试技巧" href="15922725010749.html">PHP调试技巧</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 <div class="markdown-body">
<h1>[原创翻译]QueryPath PHP的Jquery实现,QueryPath教程</h1>

<p>Tags:  QueryPath 教程 php  jquery dom 抓取 <br/>
Toc:no<br/>
Status: public<br/>
Position: 1</p>

<h1 id="toc_0">QueryPath PHP的Jquery实现</h1>

<p>HTML,HTTP和XML,是WEB技术领域无可争议的三大基础支柱技术.然而对于PHP开发者来说,在使用这三种技术的时候可能会比较麻烦.新出现的QueryPath库,是一个使用PHP实现的如同Jquery的类库,提供了方便强大的处理XML,HTTP,HTML的类库.无论是WEB网页,WEB service,SVG或者SPAARQL,RDF,Atom,QueryPath都能处理,并且用PHP语言提供了健壮并简单易用的API.在本文中,介绍了如何构建QueryPath对象,如何遍历并处理XML和HTML.</p>

<h3 id="toc_1">QueryPath</h3>

<p>从使用简单方面,QueryPath的语法很简洁,方法的名字都很短并且语义化,很容易知道是做什么的(比如text(),append(),remove()).因为很多方法返回的都是QueryPath对象,方法的调用是支持链式调用的.这种用法有时候也叫做流式接口.为了符合Javascript开发者的习惯,QueryPath实现了Jquery主要的遍历方法和操作方法.</p>

<p>从健壮性来说,QueryPath提供了载入,读取,搜索,写入XML与HTML的工具.尽管不考虑类库的大小,通用的接口还是很难满足所有的需求,QueryPath提供了扩展开发接口,可以给QueryPath添加新的方法.同时其扩展也包含了数据库支持,模板支持,以及额外的XML支持.</p>

<p>或许你也会说,为啥还需要一个XML或HTML的轮子?PHPv5已经提供了很实用的XML工具,也有DOM实现和SimpleXML类库了.答案很简单:QueryPath被设计作为一个通用的工具.DOM API复杂并且笨重.虽然它的对象模型可能很强大,但是即便实现最简单的功能都需要写很多行代码.SimpleXML,对于许多需求来说又太过简陋了.除非XML是完全确定的,使用SimpleXML来操作文档才比较简单.<br/>
    QueryPath正是力求在DOM的功能性与SimpleXML的简单之间找到一个平衡点.</p>

<h3 id="toc_2">需求:</h3>

<p>QueryPath是纯PHP的类库,所以可以直接从官方网站下载后使用</p>

<p>QueryPath的系统要求很少,只要PHPv5版本并且开启DOM扩展就可以.大部分的PHPv5发行版都符合开箱即用的需求.QueryPath不支持遗弃多年的PHPv4.</p>

<h3 id="toc_3">链式调用:</h3>

<p>QueryPaht有四个基本的概念:</p>

<pre><code class="language-text">* 一个QueryPath对象总是会与一个XML或HTML文档关联
* QueryPath可以查询文档,并生成一个匹配的结果集
* QueryPath可以操作文档,可以对文档进行新增,修改,删除操作.
* QueryPath的方法支持链式调用,所以一行语句可以执行多个方法.只需几行代码就可以对文档进行载入和增删改查等操作
</code></pre>

<p>上代码,包含如上的特点:</p>

<pre><code class="language-text">    &lt;?php
    require &#39;QueryPath/QueryPath.php&#39;;

    qp(&#39;sample.html&#39;)-&gt;find(&#39;title&#39;)-&gt;text(&#39;Hello World&#39;)-&gt;writeHTML();
    ?&gt;
</code></pre>

<p>例子中只包含了一个文件,QueryPath/QueryPath.php ,这就是使用QueryPath需要包含的唯一的文件,除非还用到了QueryPath的其他扩展.</p>

<p>下面一行代码就是QueryPath的链式调用,其做了如下事情:</p>

<pre><code class="language-text">* 新建一个QueryPath对象,并指向sample.html文档.当qp()方法执行的时候,就会创建一个新的QueryPath对象,用于之后对其进行载入和解析.
* 通过find()方法对文档进行搜索,使用CSS3选择器寻找所有&lt;title&gt;&lt;/title&gt;元素 
* title的text值设置为了Hello World,当执行到此,title的子节点都会被替换成CDATA字符串Hello World.所有的内容都会被销毁.
* 所有文档都会通过writeHTML()方法写入到标准输出.
</code></pre>

<p>上面的例子还可以简化,qp()方法支持把CSS选择器作为可选的第二个参数传入.下面是简化后的版本:</p>

<pre><code class="language-text">    &lt;?php
    require &#39;QueryPath/QueryPath.php&#39;;

    qp(&#39;sample.html&#39;, &#39;title&#39;)-&gt;text(&#39;Hello World&#39;)-&gt;writeHTML();
    ?&gt;

</code></pre>

<p>假设sample.html是空白的HTML文档,上面的例子输出会跟下面的内容差不多:</p>

<pre><code class="language-text">    &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01//EN&quot; &quot;http://www.w3.org/TR/html4/strict.dtd&quot;&gt;
    &lt;html lang=&quot;en&quot;&gt;
    &lt;head&gt;
        &lt;title&gt;Hello World&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
    &lt;/body&gt;
    &lt;/html&gt;
</code></pre>

<blockquote>
<p>这些简单的例子展示了QueryPath可以实现的功能.下面介绍一些其他的方法:</p>
</blockquote>

<h3 id="toc_4">qp()工厂方法:</h3>

<p>在QueryPath中最常用的基础方法就是qp()方法.这个方法会生成一个新的QueryPath对象,就像传统的constructor构造方法做的事情一样.</p>

<p>如果你对面向对象的开发模式比较熟悉,你可能会发现qp()方法实现了工厂模式.QueryPath采用了一个方法,而不是通过定义工厂类的构造方法来实现工厂模式.这样干能节省一些代码量,更重要的是这种实现使得QueryPath更接近jQuery,如果你对jQuery比较熟悉,学习难度曲线会降低一些吧.</p>

<p>一个QueryPath对象必须与一个XML或者HTML文档关联,一旦对象创建好,他们就会绑定在一起.qp()方法支持三个参数,都是可选的:</p>

<pre><code class="language-text">    #文档#  可以是文件名,URL,XML或者HTML字符串,DOM文档或者DOM元素,SimpleXML元素,或者一个DOM元素数组.如果不是这些支持的类型,则会创建一个空的XML文档.

    #CSS3选择器#  如果传了这个参数,载入文档的时候QueryPath会同时使用这个选择器查询文档

    #选项数组#  可以针对这个QueryPath实例,传一组配置参数进行配置.API文档有此处支持的参数的详细说明
</code></pre>

<p>qp()方法的第一个参数支持数量众多的类型的文档,从而可以很简单的创建一个QueryPath对象.QueryPath可以通过文件名或URL来载入文档.如果传的是XML/HTML字符串,也可以直接解析内容.同时,也支持DOM和SimpleXML这两种常见的XML文档.下面的例子展示了直接传XML字符串的用法:</p>

<pre><code class="language-text">    &lt;?php
    require &#39;QueryPath/QueryPath.php&#39;;

    $xml = &#39;&lt;?xml version=&quot;1.0&quot;?&gt;&lt;doc&gt;&lt;item/&gt;&lt;/doc&gt;&#39;;
    $qp  = qp($xml);
    ?&gt;
</code></pre>

<p>执行上面的代码,$qp会指向一个经过解析XML的QueryPath对象.如果PHP的配置中允许HTTP/HTTPS流式封装,(大部分PHPv5发行版都支持),则也可以通过HTTP URL来载入内容.</p>

<pre><code class="language-text">    &lt;?php
    require &#39;QueryPath/QueryPath.php&#39;;

    $qp = qp(&#39;http://example.com/file.xml&#39;);
    ?&gt;
</code></pre>

<p>因此,QueryPath也可以用来解析Web Services.创建新文档的时候,有一种方便的载入HTML样板的方式:</p>

<pre><code class="language-text">    &lt;?php
    require &#39;QueryPath/QueryPath.php&#39;;

    $qp = qp(QueryPath::HTML_STUB);
    ?&gt;
</code></pre>

<p>QueryPath::HTML_STUB包含了一个最基本的HTML样板,内容如下:</p>

<pre><code class="language-text">    &lt;?xml version=&quot;1.0&quot;?&gt;
    &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;
      &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
    &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
    &lt;head&gt;
        &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;/&gt;
        &lt;title&gt;Untitled&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;&lt;/body&gt;
    &lt;/html&gt;
</code></pre>

<p>通过样板文件,可以更快捷的创建一个新的HTML文档.</p>

<h3 id="toc_5">遍历文档</h3>

<p>打开一个文档之后,会需要对文档进行遍历来找到需要的内容.QueryPath在这方面的设计非常易用.为了满足大部分遍历的需求,QueryPath提供了多种方法,大部分都支持使用CSS3选择器来找到对应的节点.</p>

<p><img src="media/blog/QueryPath_1.gif" alt=""/></p>

<p>上图总结了最常用的遍历方法.下面有具体对应的描述.除此之外还有别的方法,这些介绍的是最常用的方法.</p>

<blockquote>
<p>find() <br/>
    在当前的节点内选择符合selector的元素(支持CSS选择器)</p>

<p>xpath()<br/>
    选择符合Xpath表达式的节点(不支持CSS选择器)</p>

<p>top()<br/>
    选择文档的根节点元素(不支持CSS选择器)</p>

<p>parents()<br/>
    选择任意多个父节点(支持CSS选择器)</p>

<p>parent()<br/>
    选择一个父节点(支持CSS选择器)</p>

<p>siblings()<br/>
    选择所有兄弟节点,前后都包括(支持CSS选择器)</p>

<p>next()<br/>
    选择下一个兄弟节点(支持CSS选择器)</p>

<p>nextAll()<br/>
    选择当前节点之后的所有兄弟节点(支持CSS选择器)</p>

<p>prev()<br/>
    选择上一个兄弟节点(支持CSS选择器)</p>

<p>prevAll()<br/>
    选择所有前面的兄弟节点(支持CSS选择器)</p>

<p>children()<br/>
    选择该节点的子节点(支持CSS选择器)</p>

<p>deepest()<br/>
    选择该节点最深的子节点或该节点下的所有子节点(不支持CSS选择器)</p>
</blockquote>

<p>QueryPath的许多方法都可以精确的查询到指定的元素,上面列出来的大部分方法都支持CSS3选择器参数.只有top()和deepest()方法是不带参数的查询方法.</p>

<p>来看一个简单的关于遍历的例子.假设有如下的XML文档:</p>

<pre><code class="language-text">    &lt;?xml version=&quot;1.0&quot;?&gt;
    &lt;root&gt;
      &lt;child id=&quot;one&quot;/&gt;
      &lt;child id=&quot;two&quot;/&gt;
      &lt;child id=&quot;three&quot;/&gt;
      &lt;ignore/&gt;
    &lt;/root&gt;
</code></pre>

<p><root/>元素有四个子元素,有三个名为<child/>的元素,还有一个<ignore/>.可以通过QueryPath方法来选择<root/>的全部子元素</p>

<pre><code class="language-text">    &lt;?php 
    require &#39;QueryPath/QueryPath.php&#39;;

    $xml = &#39;&lt;?xml version=&quot;1.0&quot;?&gt;
    &lt;root&gt;
      &lt;child id=&quot;one&quot;/&gt;
      &lt;child id=&quot;two&quot;/&gt;
      &lt;child id=&quot;three&quot;/&gt;
      &lt;ignore/&gt;
    &lt;/root&gt;&#39;;

    $qp = qp($xml, &#39;root&#39;)-&gt;children();
    print $qp-&gt;size();
    ?&gt;
</code></pre>

<p>children()方法会选择<root/>下的所有子元素,最后一行代码,打印了全部符合条件的元素,所以是4</p>

<p>如果只想选定前三个<child/>元素而忽略<ignore/>元素,代码如下</p>

<pre><code class="language-text">    &lt;?php 
    require &#39;QueryPath/QueryPath.php&#39;;

    $xml = &#39;&lt;?xml version=&quot;1.0&quot;?&gt;
    &lt;root&gt;
    &lt;child id=&quot;one&quot;/&gt;
    &lt;child id=&quot;two&quot;/&gt;
    &lt;child id=&quot;three&quot;/&gt;
    &lt;ignore/&gt;
    &lt;/root&gt;&#39;;

    $qp = qp($xml, &#39;root&#39;)-&gt;children(&#39;child&#39;);

    print $qp-&gt;size();
    ?&gt;
</code></pre>

<p>最后一行打印了符合条件的全部元素,共有3个.在QueryPath内部会保存这三个元素作为当前的上下文数据.如果想做进一步的查询,则会从这三个元素开始,如果插入数据 也会插入到这三个元素内.</p>

<h1 id="toc_6">CSS选择器</h1>

<p>CSS选择器是CSS表达式的一部分,用来确定样式会作用在哪些元素上.CSS选择器也可以在文档外部作为样式表的一部分来使用.QueryPath使用选择器作为查询的描述语言,并且支持在CSS3选择器标准中定义的特性和方法.</p>

<p>CSS选择器在QueryPath中相当重要,上面介绍了十个支持CSS选择器作为参数的方法,虽然到目前我们用过的还只是简单的tag名字查询的方法,然而CSS3选择器远比这些列举的简单例子要强大的多.更详细的描述本文不做过多介绍,只列举一些常用的例子如下</p>

<pre><code class="language-text">    选择器:p 
    描述  :找到所有标签为&lt;p/&gt;的元素 
    匹配  : &lt;p/&gt; 
</code></pre>

<pre><code class="language-text">    选择器:.container 
    描述  :找到所有class属性为container 的元素 
    匹配  :&lt;div class=&quot;container&quot;&gt;
</code></pre>

<pre><code class="language-text">    选择器:#menu 
    描述  :找到所有id属性为menu的元素.
    匹配  :&lt;div id=&quot;menu&quot;&gt;
</code></pre>

<pre><code class="language-text">    选择器:[type=&quot;inline&quot;]
    描述  :所有type属性为inline的元素
    匹配  :&lt;code type=&quot;inline&quot;/&gt;
</code></pre>

<pre><code class="language-text">    选择器:tr &gt; th 
    描述  :选择所有父元素为tr的th元素
    匹配  :&lt;tr&gt;&lt;th/&gt;&lt;/tr&gt; 
</code></pre>

<pre><code class="language-text">    选择器:table td 
    描述  :选择祖先(如父元素或祖父元素)为table的所有td元素
    匹配  :&lt;table&gt;&lt;tr&gt;&lt;td/&gt;&lt;/tr&gt;&lt;/table&gt;
</code></pre>

<pre><code class="language-text">    选择器: li:first
    描述  : 选择第一个&lt;li&gt;元素.除了:first 还支持:last  :even  :odd
    匹配  : &lt;li/&gt;
</code></pre>

<p>这些常见的选择器可以组合起来使用,从而组成复杂的查询.比如</p>

<blockquote>
<p>div.content ul&gt;li:first</p>
</blockquote>

<pre><code class="language-text">这个语句会选择全部class为content的div,在div内部搜索全部的&lt;ul/&gt;,返回每个&lt;ul/&gt;内部的第一个&lt;li/&gt;元素.
</code></pre>

<h1 id="toc_7">在返回结果中遍历</h1>

<p>上面已经介绍了两种遍历文档的方法,QueryPath内置方法和CSS3选择器.下面介绍一下如何遍历查询结果.</p>

<p>一个QueryPath对象是可以遍历的,在PHP里面来讲,是可以作为迭代器遍历的.传统的PHP循环结构就可以对QueryPath的匹配结果对象进行遍历.</p>

<p>如果想要独立的处理每个元素,也很容易.下面的例子,展示了QueryPath作为迭代器的用法.</p>

<pre><code class="language-text">    &lt;?php 
        require &#39;QueryPath/QueryPath.php&#39;;

        $xml = &#39;&lt;?xml version=&quot;1.0&quot;?&gt;
        &lt;root&gt;
        &lt;child id=&quot;one&quot;/&gt;
        &lt;child id=&quot;two&quot;/&gt;
        &lt;child id=&quot;three&quot;/&gt;
        &lt;ignore/&gt;
        &lt;/root&gt;&#39;;

        $qp = qp($xml, &#39;root&#39;)-&gt;children(&#39;child&#39;);

        foreach ($qp as $child) {
          print $child-&gt;attr(&#39;id&#39;) . PHP_EOL;
        }
    ?&gt;
</code></pre>

<p>foreach循环的每个结果会赋值给\(child变量,但\)child变量不只是一个元素,它是一个指向当前元素的QueryPath对象,所以可以对其使用QueryPath提供的那些方法.<br/>
为了与Jquery的Api保持一致,QueryPath也提供了一些读取和修改的方法.单个的方法,可以根据传递参数的不同,既能获取数据也可以修改数据.比如 attr()方法,qp()-&gt;attr(&quot;name&quot;)会获取name属性的值,qp()-&gt;attr(&quot;name&quot;,&quot;value&quot;)则会把name属性的值设置为value.其他一些方法,诸如text(),html(),xml(),都可以这样既能读取又能修改属性的值.</p>

<p>由于所有的循环结果都包装在QUeryPath对象里,所以这些$child都可以调用QueryPath的方法,比如上面的attr(),来读取或者修改元素属性.</p>

<p>上面介绍了使用QueryPath方法,CSS3选择器,迭代器来遍历文档,下面介绍一下如何用QueryPath修改文档.</p>

<h1 id="toc_8">修改文档</h1>

<p>遍历文档之后,接下来就可以对文档进行增删改查的操作了.再来看一下上面的例子.</p>

<pre><code class="language-text">    &lt;?php
    require &#39;QueryPath/QueryPath.php&#39;;

    qp(&#39;sample.html&#39;)-&gt;find(&#39;title&#39;)-&gt;text(&#39;Hello World&#39;)-&gt;writeHTML();
    ?&gt;
</code></pre>

<p>在这个例子中,使用了text()方法来修改了&lt;\title&gt;元素的内容.QueryPath提供了一堆这样的方法来修改文档. 下图展示了这些方法作用的地方,这些方法都可以用来新增或是修改数据.绿色的标签表示当前选中的元素:</p>

<p><img src="media/blog/QueryPath_2.gif" alt=""/></p>

<p>这些方法都是用来处理字符串的,通常用在HTML或者XML文档中,用来往文档中插入数据.插入后的数据立刻就可以访问和操作.</p>

<p>实际上,有两种类型的方法,其中一种可以操作XML片段,如下:</p>

<pre><code class="language-text">    append():  在当前选中的元素中插入数据作为最后一个子元素 
    prepend(): 在当前选中的元素中插入一个元素并作为第一个子元素
    after():   在当前选中的元素后插入新的元素 
    before():  在当前选中的元素前插入新的元素
    html():    用一段HTML代码替换当前元素的子元素
    xml():     用一段XML代码替换当前元素的子元素
</code></pre>

<p>上面列举的方法,参数都需要传格式化好的XML或者HTML数据.下面展示一个html()方法的例子:</p>

<pre><code class="language-text">    &lt;?php
    require &#39;QueryPath/QueryPath.php&#39;;

    qp($file)-&gt;find(&#39;div.content&#39;)-&gt;html(&#39;&lt;ul&gt;&lt;li&gt;One&lt;/li&gt;&lt;/ul&gt;&#39;);
    ?&gt;
</code></pre>

<p>上面图片列举的操作方法没有包括remove()方法,这玩意实在是没法画出来.这个方法是从文档中删除元素用的,如果调用的时候不传参数,则会把当前选中的元素干掉.但是,就像其他QueryPath的方法一样,remove()也可以传CSS3选择器参数,然后把所有符合条件的元素删掉.</p>

<p>另一类方法,是用来操作元素属性的,只有两个:</p>

<pre><code class="language-text">    attr():      获取/设置所有选中元素的属性
    addClass():  为当前选中的所有元素添加一个类
</code></pre>

<p>也有其他一些跟属性相关的方法,比如removeClass(),可以传一个类名,然后会把元素中相关的类删掉.removeAttr()方法,可以传一个属性名作为参数,然后把当前所有选中元素的属性删掉.</p>

<p>如此这般,把这些基本的工具组合在一起,就能实现强大的功能了.下面的例子是基于Twitter的,就不翻译啦.</p>

<p>原文地址:<a href="http://www.ibm.com/developerworks/library/os-php-querypath/">http://www.ibm.com/developerworks/library/os-php-querypath/</a></p>


</div>

<br /><br />
<hr />

<div class="row clearfix">
  <div class="large-6 columns">
	<div class="text-left" style="padding:15px 0px;">
		
	        <a href="15923063087852.html"  title="Previous Post: 使用GITHUB+JustWriting搭建BLOG">&laquo; 使用GITHUB+JustWriting搭建BLOG</a>
	    
	</div>
  </div>
  <div class="large-6 columns">
	<div class="text-right" style="padding:15px 0px;">
		
	        <a href="15923063088164.html" 
	        title="Next Post: kvm/virsh 异常断电导致虚拟机无法启动的修复实战">kvm/virsh 异常断电导致虚拟机无法启动的修复实战 &raquo;</a>
	    
	</div>
  </div>
</div>

<div class="row">
<div style="padding:0px 0.93em;" class="share-comments">

</div>
</div>
<script type="text/javascript">
	$(function(){
		var currentURL = '15923063087972.html';
		$('#side-nav a').each(function(){
			if($(this).attr('href') == currentURL){
				$(this).parent().addClass('active');
			}
		});
	});
</script>  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2020
备案信息: <a target="_blank" href="http://www.mweb.im">京ICP备14056617号</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    


  </body>
</html>
